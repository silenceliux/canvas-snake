<!DOCTYPE html>
<html>
<head>
    <title></title>
</head>
<body>
<style>
    *{
        margin: 0;
        padding: 0;
    }
    html,body{
        height:100%;
        width:100%;
    }
    #myCanvas,#myCanvas2{
        display:block;
        position: absolute;
        top: 0;
        left: 0;
    }
    #myCanvas{
        z-index: 2;
    }
    #control{
         width: 10vh;
        height: 10vh;
        border-radius: 50%;
        z-index: 10;
        background-color: gray;
        position: fixed;
        top: 5vh;
        left: 5vh;
    }
    #direction{
        width: 5vh;
        height: 5vh;
        border-radius: 50%;
        z-index: 15;
        background-color: lightgray;
        position: fixed;
        top: 7.5vh;
        left: 7.5vh;
    }
</style>
    <canvas id="myCanvas"></canvas>
    <canvas id="myCanvas2"></canvas>
    <div id="control"><div id="direction"></div></div>
    <script>
        var c1=document.getElementById("myCanvas");
        var c2=document.getElementById("myCanvas2");
        var width = document.body.clientWidth;
        var height = document.body.clientHeight;
        var direction = document.getElementById("direction");
        c1.width = width;
        c1.height = height;
        c2.width = width;
        c2.height = height;
        var cxt1=c1.getContext("2d");
        var cxt2=c2.getContext("2d");
        var snack = [{x:500,y:500}];
        cxt1.fillStyle="#FF0000";
        var addOne={};
        var startX = height/10,startY = height/10,sportX = 0,sportY = 1;
        var sportTime;
        var sportPath = [];
        direction.addEventListener('touchmove', function (event) {
            var touch = event.touches[0]; //获取第一个触点
            var x = touch.clientX;
            var y = touch.clientY;
            var left,top;
            if(x-(height/40) < height/20 ){
                left = height/20;
            }
            else if(x-(height/40) > height/10){
                left = height/10;
            }
            else{
                left = x-(height/40);
            }
            if(y-(height/40) < height/20 ){
                top = height/20;
            }
            else if(y-(height/40) > height/10){
                top = height/10;
            }
            else{
                top = y-(height/40);
            }
            direction.style.left=left+"px";
            direction.style.top=top+"px";
            var moveX = x-startX;
            var moveY = y - startY;
            var moveRatio = moveX/moveY;
            sportY = Math.sqrt(1/(moveRatio*moveRatio+1))*(Math.abs(moveY)/moveY);
            sportX = sportY*Math.abs(moveRatio)*(Math.abs(moveX)/moveX);
//                sportX = Math.abs(moveX/moveY)>1?Math.abs(moveX)/moveX:moveX/Math.abs(moveY);
//                sportY = Math.abs(moveX/moveY)>1?moveY/Math.abs(moveX):Math.abs(moveY)/moveY;

            clearTimeout(sportTime);
            sport();
        }, false);
        direction.addEventListener('touchend', function (event) {
            direction.style.left="7.5vh";
            direction.style.top="7.5vh";
        }, false);

        function init(){
            initPath();
            render();
            apple();
            addSnack();
//            sport();
        }
        function initPath(){
            for(var i=0;i<30;i++){
                sportPath[i] = {};
                sportPath[i].x = 500;
                sportPath[i].y = 500+i;
            }
        }
        function render(){
            cxt1.clearRect(0,0,width,height);
            for(var i=0;i<snack.length;i++){
                cxt1.beginPath();
                cxt1.arc(snack[i].x,snack[i].y,15,0,Math.PI*2);
                cxt1.closePath();
                cxt1.fill();
            }
        }
        function addSnack(){
            var obj  ={};
            obj.x = snack[snack.length-1].x;
            obj.y = snack[snack.length-1].y+30;
            snack.push(obj);
            render();
        }
        function apple(){
            cxt2.fillStyle="#00FF00";
            var x = Math.floor(Math.random()*500);
            var y = Math.floor(Math.random()*500);
            cxt2.beginPath();
            cxt2.arc(x,y,10,0,Math.PI*2);
            cxt2.closePath();
            cxt2.fill();
        }
        function sport(){
            var obj={};
        //写移动的距离
            var x, y,moveX,moveY;
//            for(var i=snack.length-1;i>0;i--){
//                x = snack[i-1].x - snack[i].x;
//                y = snack[i-1].y - snack[i].y;
//                moveX = Math.abs(x/y)>1?Math.abs(x)/x:x/Math.abs(y);
//                moveY = Math.abs(x/y)>1?y/Math.abs(x):Math.abs(y)/y;
//                snack[i].x += moveX;
//                snack[i].y += moveY;
//            }

            snack[0].x += sportX;
            snack[0].y += sportY;
            if(snack[0].x>width-15 || snack[0].x<15 || snack[0].y>height-15 || snack[0].y<15){
                console.log("shule");
                clearTimeout(sportTime);
                return;
            }
            obj.x = snack[0].x;
            obj.y = snack[0].y;
            sportPath.unshift(obj);
            for(var i=1;i<snack.length;i++){
                snack[i].x = sportPath[i*30].x;
                snack[i].y = sportPath[i*30].y;
            }
            if(sportPath.length > snack.length*30+3){
                sportPath.splice(snack.length*30+3,(sportPath.length - snack.length*30+3));
            }

            render();
            sportTime = setTimeout(sport,10);
        }
       init();
    </script>
</body>
</html>